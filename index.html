---
layout: base.njk
title: Latina live. ¬°tu alma, tu m√∫sica!
---

<!-- Player Section -->
<section class="player-container text-center" id="player" aria-labelledby="player-title">
  <h1 id="player-title">¬°Sinton√≠zate con nosotros!</h1>
  <p class="mb-4">Vibra en nuestra onda...</p>
  <p>Actualmente: <span id="nombre-locutor" style="font-weight:bold; color:var(--brand-primary);">Cargando...</span></p>

  <script>
    async function actualizarLocutor() {
      try {
        const respuesta = await fetch('https://latinalive.net/api/estado');
        const datos = await respuesta.json();
        document.getElementById('nombre-locutor').innerText = datos.locutor;
      } catch (error) {
        // Silently fail or keep previous
        console.log("Locutor update failed", error);
      }
    }
    setInterval(actualizarLocutor, 10000);
    actualizarLocutor();
  </script>

  <div class="audio-player">
    <audio id="audio" controls autoplay preload="none" src="https://radios.latinalive.net/listen/latina/live">
      Tu navegador no soporta el elemento de audio.
    </audio>
    <div class="track-info" id="track-info" style="font-weight: 600; font-size: 1.2rem; color: var(--brand-primary);">
      Cargando informaci√≥n...
    </div>

    <div class="controls" style="margin: 1rem 0; display: flex; gap: 1rem; justify-content: center;">
      <button id="lowerVolumeBtn" aria-label="Bajar volumen" class="btn" style="padding: 0.8rem 1.5rem;">- Vol</button>
      <button id="raiseVolumeBtn" aria-label="Subir volumen" class="btn" style="padding: 0.8rem 1.5rem;">+ Vol</button>
    </div>
    <div class="volume-display" id="volume-display"
      style="font-size: 1rem; color: var(--text-muted); transition: transform 0.2s;">
      Volumen: 100%
    </div>

    <div style="margin-top: 1.5rem;">
      <a href="/stream.m3u" class="external-player-link"
        style="font-size: 0.9rem; text-decoration: underline;">Reproductor Externo</a>
    </div>
  </div>
</section>

<script src="/scripts/player.js" defer></script>

<!-- Requests Section -->
<section class="requests-section card text-center" aria-labelledby="requests-title"
  style="border: 2px solid var(--brand-primary);">
  <h2 id="requests-title">Pide tu Canci√≥n</h2>
  <p>¬°Queremos escucharte! pedir tu canci√≥n favorita es f√°cil...</p>
  <a href="/pedidos/" class="btn" style="margin-top: 1rem; font-size: 1.2rem;">Hacer un Pedido</a>
</section>

<!-- Chat Section -->
<section class="chat-section card" aria-labelledby="chat-title">
  <h2 id="chat-title" class="text-center">Chat en Vivo</h2>
  <div id="chat-container"
    style="height:400px; overflow-y:scroll; padding:1rem; margin-bottom: 1rem; background: var(--bg-primary); border-radius: 8px;">
    <div id="mensajes-box" role="log"></div>
  </div>

  <div class="chat-controls">
    <input type="text" id="chat-nombre" placeholder="Tu nombre" aria-label="Tu nombre">
    <input type="text" id="chat-msg" placeholder="Escribe un mensaje..." aria-label="Escribe un mensaje">
    <button onclick="enviarMensaje()" style="width: 100%;">Enviar</button>
  </div>
</section>

<script>
  async function enviarMensaje() {
    const usuarioInput = document.getElementById('chat-nombre');
    const mensajeInput = document.getElementById('chat-msg');

    const usuario = usuarioInput.value || "Invitado";
    const mensaje = mensajeInput.value;

    if (!mensaje) return;

    try {
      await fetch('https://latinalive.net/api/enviar-web', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ usuario, mensaje })
      });
      mensajeInput.value = '';
      cargarChat();
    } catch (e) {
      console.error("Error sending message", e);
    }
  }

  let lastMessageCount = 0;

  async function cargarChat() {
    try {
      const res = await fetch('https://latinalive.net/api/leer-chat');
      const data = await res.json();
      // Handle different response structures if needed, assuming array or object with messages
      const mensajes = Array.isArray(data) ? data : (data.mensajes || []);

      const box = document.getElementById('mensajes-box');

      // Highlight New Messages if count increased (simple logic)
      if (mensajes.length > lastMessageCount && lastMessageCount !== 0) {
        // Could add sound or visual cue here
      }
      lastMessageCount = mensajes.length;

      box.innerHTML = mensajes.map(m => {
        // Format timestamp
        const date = new Date(m.fecha || Date.now());
        const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        return `
                <p style="margin-bottom: 0.5rem; padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <small style="color: var(--brand-primary); margin-right: 0.5rem;">[${timeStr}]</small> 
                    <strong>${m.usuario}:</strong> 
                    <span style="color: var(--text-main);">${m.mensaje}</span>
                </p>
                `;
      }).join('');

      // Auto scroll to bottom
      box.scrollTop = box.scrollHeight;
    } catch (e) {
      console.error("Error loading chat", e);
    }
  }

  setInterval(cargarChat, 4000);
  cargarChat();

  // Allow Enter key to send
  document.getElementById('chat-msg').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      enviarMensaje();
    }
  });
</script>

<!-- Donate/Support Section -->
<section class="support-section card text-center" style="border-color: var(--brand-secondary);">
  <h3>¬°Sue√±a con nosotros! üìª</h3>
  <p>¬øTe gusta nuestra sinton√≠a? Ven con nosotros, el cielo solo es una parada; los sue√±os no tienen precio.</p>
  <a href="http://paypal.me/sanaguidj" class="btn" style="background: var(--brand-secondary); margin-top: 1rem;">‚òÅ ¬°Pon
    tu pelda√±o nubal
    aqu√≠! üå†</a>
</section>